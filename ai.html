<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø´Ø§ÙˆØ±Ù‡ ØªØ®ØµØµÛŒ Ø¯Ú©ØªØ± Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
    body { font-family: 'Vazirmatn', sans-serif; background: #f3f4f6; }
    .chat-container { max-width: 600px; margin: 32px auto; background: #fff; border-radius: 1.5rem; box-shadow: 0 10px 25px rgba(0,0,0,.09); display: flex; flex-direction: column; min-height: 85vh; max-height: 820px; }
    .chat-header { background: linear-gradient(90deg, #6366f1 70%, #818cf8 100%); color: #fff; padding: 1.6rem; text-align: center; font-size: 1.3rem; font-weight: bold; border-top-left-radius: 1.5rem; border-top-right-radius: 1.5rem; }
    .chat-messages { flex: 1; padding: 1.3rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1.1rem; background: #f9fafb; }
    .message { max-width: 92%; padding: .82rem 1.08rem; border-radius: 1rem; line-height: 1.8; font-size: 1.1rem; }
    .message.user { background: #e0e7ff; align-self: flex-end; color: #3730a3; border-bottom-right-radius: .2rem; }
    .message.bot { background: #f0fdf4; align-self: flex-start; color: #047857; border-bottom-left-radius: .2rem; }
    .chat-input-container { display: flex; padding: 1.2rem; border-top: 1px solid #e5e7eb; background: #fff; border-bottom-left-radius: 1.5rem; border-bottom-right-radius: 1.5rem; }
    .chat-input { flex: 1; padding: 0.8rem 1rem; border: 1px solid #d1d5db; border-radius: 0.8rem; font-size: 1.1rem; outline: none; text-align: right; }
    .send-button { background: #6366f1; color: #fff; border: none; padding: 0.8rem 1.2rem; border-radius: 0.8rem; margin-right: 1rem; cursor: pointer; font-size: 1.15rem; }
    .loading-indicator { display: flex; align-items: center; justify-content: flex-start; padding: 0.7rem 1rem; border-radius: 1rem; background: #e0f2fe; align-self: flex-start; color: #2563eb; }
    .loading-indicator .dot { width: 8px; height: 8px; background: #2563eb; border-radius: 50%; margin: 0 2px; animation: bounce 0.65s infinite alternate; }
    .loading-indicator .dot:nth-child(2) { animation-delay: .22s; }
    .loading-indicator .dot:nth-child(3) { animation-delay: .44s; }
    @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-6px); } }
  </style>
</head>
<body>
<div class="chat-container">
  <div class="chat-header">Ù…Ø´Ø§ÙˆØ±Ù‡ ØªØ®ØµØµÛŒ Ø¯Ú©ØªØ± Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±</div>
  <div class="chat-messages" id="chat-messages"></div>
  <div class="chat-input-container">
    <input type="text" id="user-input" class="chat-input" placeholder="Ù¾Ø§Ø³Ø® ÛŒØ§ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." autocomplete="off" />
    <button id="send-button" class="send-button"><span>&#x1F680;</span></button>
  </div>
</div>
<script type="module">
// Ø¢Ø¯Ø±Ø³ Worker Ø§Ø®ØªØµØ§ØµÛŒ (Cloudflare Worker)
const API_URL = "https://iranpowder.peymaancrafts.workers.dev/";

const azarpowderProducts = [
  { name: "Ù¾Ø±ÙˆØªØ¦ÛŒÙ† ÙˆÛŒ Ø§ÛŒØ²ÙˆÙ„Ù‡ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û³,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "whey-isolate", howToUse: "ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ø¨Ø¹Ø¯ ØªÙ…Ø±ÛŒÙ† Ùˆ ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ ØµØ¨Ø­", sideEffects: "Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ù„Ø§Ú©ØªÙˆØ² Ù…Ù†Ø§Ø³Ø¨â€ŒØªØ± Ø§Ø³Øª.", description: "Ù¾Ø±ÙˆØªØ¦ÛŒÙ† ÙˆÛŒ Ø§ÛŒØ²ÙˆÙ„Ù‡ Ø¨Ø§ Ø¬Ø°Ø¨ Ø¨Ø³ÛŒØ§Ø± Ø³Ø±ÛŒØ¹ØŒ Ù…Ù†Ø§Ø³Ø¨ Ø±ÛŒÚ©Ø§ÙˆØ±ÛŒ Ùˆ Ø¹Ø¶Ù„Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙˆÛŒÚ˜Ù‡ ÙˆØ±Ø²Ø´Ú©Ø§Ø±Ø§Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ø§ÙØ±Ø§Ø¯ÛŒ Ø¨Ø§ Ø­Ø³Ø§Ø³ÛŒØª Ø¨Ù‡ Ù„Ø§Ú©ØªÙˆØ²." },
  { name: "Ù¾Ø±ÙˆØªØ¦ÛŒÙ† ÙˆÛŒ Ú©Ù†Ø³Ø§Ù†ØªØ±Ù‡ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û²,Û¹Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "protein-whey", howToUse: "ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ø¨Ø¹Ø¯ ØªÙ…Ø±ÛŒÙ† Ùˆ ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ ØµØ¨Ø­ Ù†Ø§Ø´ØªØ§", sideEffects: "Ø¯Ø± Ø§ÙØ±Ø§Ø¯ Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ù„Ø§Ú©ØªÙˆØ² Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…ÙˆØ¬Ø¨ Ù†ÙØ® Ø´ÙˆØ¯.", description: "ÙˆÛŒ Ú©Ù†Ø³Ø§Ù†ØªØ±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ ØªÙˆØ¯Ù‡ Ø¹Ø¶Ù„Ø§Ù†ÛŒ Ùˆ Ø±ÛŒÚ©Ø§ÙˆØ±ÛŒ Ø¨Ø¹Ø¯ ØªÙ…Ø±ÛŒÙ†." },
  { name: "Ù¾Ø±ÙˆØªØ¦ÛŒÙ† Ú©Ø§Ø²Ø¦ÛŒÙ† Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û³,Û±ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "casein", howToUse: "ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ù‚Ø¨Ù„ Ø®ÙˆØ§Ø¨ ÛŒØ§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…ÛŒØ§Ù†â€ŒÙˆØ¹Ø¯Ù‡", sideEffects: "Ø¯Ø± Ù…ØµØ±Ù Ø¨Ø§Ù„Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…ÙˆØ¬Ø¨ Ø§Ø­Ø³Ø§Ø³ Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ø´ÙˆØ¯.", description: "Ú©Ø§Ø²Ø¦ÛŒÙ† Ø¨Ø§ Ø¬Ø°Ø¨ Ø¢Ù‡Ø³ØªÙ‡ØŒ Ú¯Ø²ÛŒÙ†Ù‡ Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§ÙØ¸Øª Ø§Ø² Ø¹Ø¶Ù„Ø§Øª Ù‡Ù†Ú¯Ø§Ù… Ø®ÙˆØ§Ø¨ ÛŒØ§ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø§Ø³ØªØ±Ø§Ø­Øª." },
  { name: "Ú©Ù„Ø§Ú˜Ù† Ù‡ÛŒØ¯Ø±ÙˆÙ„ÛŒØ² Ø´Ø¯Ù‡ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û²,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "collagen", howToUse: "ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ ØµØ¨Ø­ ÛŒØ§ Ù‚Ø¨Ù„ Ø®ÙˆØ§Ø¨", sideEffects: "ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ Ø¨ÛŒâ€ŒØ¹Ø§Ø±Ø¶Ù‡ØŒ ÙÙ‚Ø· Ø¯Ø± Ø§ÙØ±Ø§Ø¯ Ø®Ø§Øµ Ø·Ø¹Ù… Ù†Ø§Ø®ÙˆØ´Ø§ÛŒÙ†Ø¯ Ø¯Ø§Ø±Ø¯.", description: "Ú©Ù„Ø§Ú˜Ù† Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…Øª Ù¾ÙˆØ³ØªØŒ Ù…ÙˆØŒ Ù…ÙØ§ØµÙ„ Ùˆ Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¨Ù‡Ø¨ÙˆØ¯ Ø±ÛŒÚ©Ø§ÙˆØ±ÛŒ Ø¢Ø³ÛŒØ¨â€ŒÙ‡Ø§ÛŒ ÙˆØ±Ø²Ø´ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª." },
  { name: "Ú¯ÛŒÙ†Ø± Ù¾Ø±Ú©Ø§Ù„Ø±ÛŒ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û²,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "gainer", howToUse: "Ø¯Ùˆ Ù¾ÛŒÙ…Ø§Ù†Ù‡ Ø¯Ø± Ø±ÙˆØ² (Ù…ÛŒØ§Ù† ÙˆØ¹Ø¯Ù‡ Ùˆ Ø¨Ø¹Ø¯ ØªÙ…Ø±ÛŒÙ†)", sideEffects: "Ø¯Ø± ØµÙˆØ±Øª Ù…ØµØ±Ù Ø²ÛŒØ§Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…ÙˆØ¬Ø¨ Ø§ÙØ²Ø§ÛŒØ´ Ú†Ø±Ø¨ÛŒ Ø´ÙˆØ¯.", description: "Ú¯ÛŒÙ†Ø± ØªØ±Ú©ÛŒØ¨ Ù¾Ø±ÙˆØªØ¦ÛŒÙ† Ùˆ Ú©Ø±Ø¨ÙˆÙ‡ÛŒØ¯Ø±Ø§Øª Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ÛŒ Ú©Ù‡ Ø¨Ù‡ Ø³Ø®ØªÛŒ ÙˆØ²Ù† Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ ÛŒØ§ Ø¨Ù‡ Ø¯Ù†Ø¨Ø§Ù„ Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±ÛŒØ¹ Ø­Ø¬Ù… Ø¹Ø¶Ù„Ù‡ Ù‡Ø³ØªÙ†Ø¯." },
  { name: "Ú©Ø±Ø§ØªÛŒÙ† Ù…ÙˆÙ†ÙˆÙ‡ÛŒØ¯Ø±Ø§Øª Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û±,Û²Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "creatine-monohydrate", howToUse: "Ûµ Ú¯Ø±Ù… Ø±ÙˆØ²Ø§Ù†Ù‡ Ù‡Ù…Ø±Ø§Ù‡ Ø¢Ø¨ØŒ Ø¨Ø¹Ø¯ ØªÙ…Ø±ÛŒÙ†", sideEffects: "Ù…ØµØ±Ù Ø¢Ø¨ Ú©Ø§ÙÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³ØªØ› Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø§Ø­ØªØ¨Ø§Ø³ Ø¢Ø¨ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.", description: "Ú©Ø±Ø§ØªÛŒÙ† Ø¨Ø§Ø¹Ø« Ø§ÙØ²Ø§ÛŒØ´ Ù‚Ø¯Ø±ØªØŒ Ø­Ø¬Ù… Ø¹Ø¶Ù„Ø§Ù†ÛŒ Ùˆ Ø±ÛŒÚ©Ø§ÙˆØ±ÛŒ Ø³Ø±ÛŒØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
  { name: "Ø¢Ù…ÛŒÙ†ÙˆØ§Ø³ÛŒØ¯ Ø´Ø§Ø®Ù‡â€ŒØ¯Ø§Ø± (BCAA) Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û±,ÛµÛ°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "bcaa", howToUse: "Û±Û° Ú¯Ø±Ù… Ù‚Ø¨Ù„ ÛŒØ§ Ø­ÛŒÙ† ØªÙ…Ø±ÛŒÙ†", sideEffects: "Ø¨ÛŒâ€ŒØ¹Ø§Ø±Ø¶Ù‡ Ø¯Ø± Ù…ØµØ±Ù ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡.", description: "BCAA Ù…Ø§Ù†Ø¹ ØªØ®Ø±ÛŒØ¨ Ø¹Ø¶Ù„Ø§Øª Ùˆ Ú©Ø§Ù‡Ø´ Ø®Ø³ØªÚ¯ÛŒ Ø¯Ø± ØªÙ…Ø±ÛŒÙ†Ø§Øª Ø·ÙˆÙ„Ø§Ù†ÛŒ Ùˆ Ù‡ÙˆØ§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
  { name: "Ú¯Ù„ÙˆØªØ§Ù…ÛŒÙ† Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û±,Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "glutamine", howToUse: "Ûµ Ú¯Ø±Ù… Ù¾Ø³ Ø§Ø² ØªÙ…Ø±ÛŒÙ† Ùˆ Ù‚Ø¨Ù„ Ø®ÙˆØ§Ø¨", sideEffects: "Ø¨ÛŒâ€ŒØ¹Ø§Ø±Ø¶Ù‡", description: "Ú¯Ù„ÙˆØªØ§Ù…ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø±ÛŒÚ©Ø§ÙˆØ±ÛŒØŒ ØªÙ‚ÙˆÛŒØª Ø³ÛŒØ³ØªÙ… Ø§ÛŒÙ…Ù†ÛŒ Ùˆ Ú©Ø§Ù‡Ø´ Ú©ÙˆÙØªÚ¯ÛŒ Ù…ÙÛŒØ¯ Ø§Ø³Øª." },
  { name: "Ù…ÙˆÙ„ØªÛŒâ€ŒÙˆÛŒØªØ§Ù…ÛŒÙ† ÙˆØ±Ø²Ø´ÛŒ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û¸ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "multi-vitamin", howToUse: "ÛŒÚ© Ù‚Ø±Øµ Ù‡Ù…Ø±Ø§Ù‡ ØµØ¨Ø­Ø§Ù†Ù‡", sideEffects: "Ù…ØµØ±Ù Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ ÙˆÛŒØªØ§Ù…ÛŒÙ† A Ùˆ D ØªÙˆØµÛŒÙ‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.", description: "Ù…ÙˆÙ„ØªÛŒâ€ŒÙˆÛŒØªØ§Ù…ÛŒÙ† Ù…Ø®ØµÙˆØµ ÙˆØ±Ø²Ø´Ú©Ø§Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ ØªØ£Ù…ÛŒÙ† Ù†ÛŒØ§Ø²Ù‡Ø§ÛŒ Ø±ÛŒØ²Ù…ØºØ°ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡." },
  { name: "Ù¾Ù…Ù¾ (Pre-workout) Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û±,Û¸Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "preworkout", howToUse: "ÛŒÚ© Ù¾ÛŒÙ…Ø§Ù†Ù‡ Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ù‚Ø¨Ù„ ØªÙ…Ø±ÛŒÙ†", sideEffects: "Ø¯Ø± ÙØ´Ø§Ø± Ø®ÙˆÙ† Ø¨Ø§Ù„Ø§ ÛŒØ§ Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ù‚Ù„Ø¨ÛŒ ÙÙ‚Ø· Ø¨Ø§ ØªØ¬ÙˆÛŒØ² Ù¾Ø²Ø´Ú©.", description: "Ù¾Ù…Ù¾ Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ù‡Ù†Ø¯Ù‡ Ø§Ù†Ø±Ú˜ÛŒØŒ ØªÙ…Ø±Ú©Ø² Ùˆ Ø®ÙˆÙ†â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¹Ø¶Ù„Ø§Øª Ø§Ø³Øª." },
  { name: "Ø§ÙÙ…Ú¯Ø§Û³ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±", price: "Û¹Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "omega-3", howToUse: "ÛŒÚ© Ú©Ù¾Ø³ÙˆÙ„ Ø¨Ø§ ÙˆØ¹Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ", sideEffects: "Ø¯Ø± Ø§ÙØ±Ø§Ø¯ Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ù…Ø§Ù‡ÛŒ Ù…Ù†Ø¹ Ù…ØµØ±Ù Ø¯Ø§Ø±Ø¯.", description: "Ø§ÙÙ…Ú¯Ø§Û³ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…Øª Ù‚Ù„Ø¨ØŒ Ù…ÙØ§ØµÙ„ Ùˆ Ú©Ø§Ù‡Ø´ Ø§Ù„ØªÙ‡Ø§Ø¨ Ø¨Ø³ÛŒØ§Ø± Ù…ÙÛŒØ¯ Ø§Ø³Øª." },
  { name: "Ú©Ù¾Ø³ÙˆÙ„ ÙˆÛŒØªØ§Ù…ÛŒÙ† D3 Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø± (ÛµÛ°Û°Û° ÙˆØ§Ø­Ø¯)", price: "Û¶Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†", url: "vitamin-d3", howToUse: "Ù‡ÙØªÙ‡â€ŒØ§ÛŒ Ø¯Ùˆ ØªØ§ Ø³Ù‡ Ø¨Ø§Ø± ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø¹Ø¯ ØºØ°Ø§", sideEffects: "Ù…ØµØ±Ù Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø¨Ø§Ø¹Ø« Ù…Ø³Ù…ÙˆÙ…ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯.", description: "ÙˆÛŒØªØ§Ù…ÛŒÙ† D3 Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…Øª Ø§Ø³ØªØ®ÙˆØ§Ù† Ùˆ Ø³ÛŒØ³ØªÙ… Ø§ÛŒÙ…Ù†ÛŒ ÙˆØ±Ø²Ø´Ú©Ø§Ø±Ø§Ù† Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª." }
];

// Ù…Ø±Ø§Ø­Ù„ Ú¯ÙØªÚ¯ÙˆØŒ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ ÛŒÚ© Ø³ÙˆØ§Ù„ Ùˆ ØªØ´ÙˆÛŒÙ‚ Ùˆ ØªÚ©Ø±Ø§Ø± Ø¨Ø§ Ù„Ø­Ù† Ø¯Ú©ØªØ± Ù…ØªØ®ØµØµ
const FIELDS = [
  {
    key: "gender",
    ask: [
      "Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´Ù… Ø¨Ø¯ÙˆÙ†Ù… Ø®Ø§Ù†Ù… Ù‡Ø³ØªÛŒØ¯ ÛŒØ§ Ø¢Ù‚Ø§ØŸ Ø§ÛŒÙ† ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø¨Ù‡ØªØ± Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØªÙˆÙ† Ù¾Ø±Ø³ÛŒØ¯Ù‡ Ù…ÛŒØ´Ù‡."
    ],
    retry: [
      "Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ Ø®Ø§Ù†Ù… Ù‡Ø³ØªÛŒØ¯ ÛŒØ§ Ø¢Ù‚Ø§ (Ø§Ú¯Ø± Ø¯ÙˆØ³Øª Ù†Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ø±Ø¯)."
    ],
    validate: v => /Ø®Ø§Ù†Ù…|Ø¢Ù‚Ø§|Ù…Ø±Ø¯|Ø²Ù†/i.test((v||"").replace(/ /g,''))
  },
  {
    key: "name",
    ask: [
      "Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù…Ø´Ø§ÙˆØ±Ù‡ ÙˆØ§Ø±Ø¯ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯."
    ],
    retry: [
      "Ø¬Ù‡Øª ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙ†Ø¯Ù‡ Ù…Ø´Ø§ÙˆØ±Ù‡ØŒ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ø§Ù…Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯. Ø§Ú¯Ø± Ù…Ø§ÛŒÙ„ Ù†ÛŒØ³ØªÛŒØ¯ØŒ Ú©Ø§ÙÛŒØ³Øª Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ø±Ø¯."
    ],
    validate: v => v && v.trim().split(" ").length > 1 && v.trim().length > 4
  },

  {
    key: "age",
    ask: [
      n => `Ø¹Ø§Ù„ÛŒ! ${n ? n + " Ø¬Ø§Ù†" : ""} Ø³Ù† Ø±Ùˆ Ù‡Ù… Ù„Ø·Ù Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ø¨Ú¯ÛŒØ¯ØŸ ÙÙ‚Ø· Ø¹Ø¯Ø¯ Ú©Ø§ÙÛŒØ³Øª.`
    ],
    retry: [
      "Ù„Ø·ÙØ§Ù‹ Ø³Ù† Ø®ÙˆØ¯ Ø±Ø§ ÙÙ‚Ø· Ø¨Ù‡ Ø¹Ø¯Ø¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Û²Û¹). Ø§Ú¯Ø± Ù…Ø§ÛŒÙ„ Ù†ÛŒØ³ØªÛŒØ¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ø±Ø¯."
    ],
    validate: v => /^\d+$/.test(v) && +v > 10 && +v < 100
  },
  {
    key: "height",
    ask: [
      "Ù‚Ø¯ØªÙˆÙ† Ø±Ùˆ Ú†Ù†Ø¯ Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Û±Û¸Û±)."
    ],
    retry: [
      "Ù„Ø·ÙØ§Ù‹ Ù‚Ø¯ Ø±Ùˆ ÙÙ‚Ø· Ø¨Ø§ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ø§Ú¯Ø± Ù†Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ø±Ø¯."
    ],
    validate: v => /^\d+$/.test(v) && +v > 100 && +v < 250
  },
  {
    key: "weight",
    ask: [
      "ÙˆØ²Ù† ÙØ¹Ù„ÛŒâ€ŒØªÙˆÙ† Ø±Ùˆ Ú†Ù†Ø¯ Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù… Ù‡Ø³ØªØŸ"
    ],
    retry: [
      "ÙˆØ²Ù† Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ùˆ Ù†ÙˆØ¹ Ù…Ú©Ù…Ù„ Ù…Ù‡Ù…Ù‡. ÙÙ‚Ø· Ø¹Ø¯Ø¯ Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ Ø±Ø¯ Ú©Ù†ÛŒØ¯."
    ],
    validate: v => /^\d+$/.test(v) && +v > 20 && +v < 300
  },
  {
    key: "goal",
    ask: [
      "Ù‡Ø¯Ù Ø´Ù…Ø§ Ø§Ø² Ø§ÛŒÙ† Ù…Ø´Ø§ÙˆØ±Ù‡ Ú†ÛŒÙ‡ØŸ Ù…Ø«Ù„Ø§Ù‹ Ø§ÙØ²Ø§ÛŒØ´ Ø¹Ø¶Ù„Ù‡ØŒ Ú©Ø§Ù‡Ø´ ÙˆØ²Ù†ØŒ ØªÙ†Ø§Ø³Ø¨ Ø§Ù†Ø¯Ø§Ù…ØŒ ÛŒØ§ Ø³Ù„Ø§Ù…Øª Ø¹Ù…ÙˆÙ…ÛŒØŸ Ø¨Ø§ Ù‡Ø± Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒØ¯ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒØ¯."
    ],
    retry: [
      "Ù‡Ø¯Ù Ø¯Ù‚ÛŒÙ‚â€ŒØªÙˆÙ† Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯Ø› Ù…Ø«Ù„Ø§Ù‹ Ú©Ø§Ù‡Ø´ ÙˆØ²Ù†ØŒ Ø¹Ø¶Ù„Ù‡â€ŒØ³Ø§Ø²ÛŒØŒ Ø§Ù†Ø±Ú˜ÛŒ Ø¨ÛŒØ´ØªØ± ÛŒØ§ Ù‡Ø± Ù…ÙˆØ¶ÙˆØ¹ÛŒ Ú©Ù‡ Ù…Ø¯Ù†Ø¸Ø±ØªÙˆÙ†Ù‡."
    ],
    validate: v => v && v.trim().length > 2
  },
  {
    key: "trainingHistory",
    ask: [
      "Ø¯Ø± Ù…ÙˆØ±Ø¯ ÙˆØ±Ø²Ø´ Ùˆ ÙØ¹Ø§Ù„ÛŒØª Ø¨Ø¯Ù†ÛŒ: Ú†Ù†Ø¯ ÙˆÙ‚Øª Ù‡Ø³Øª ÙˆØ±Ø²Ø´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ùˆ Ú†Ù‡ Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§ÛŒÛŒ Ø±Ùˆ Ø¬Ø¯ÛŒâ€ŒØªØ± Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø±Ø¯ÛŒØ¯ØŸ"
    ],
    retry: [
      "Ø³Ø§Ø¨Ù‚Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ùˆ Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ØªÙ…Ø±ÛŒÙ† Ø¯Ø§Ø´ØªÛŒØ¯ Ø±Ùˆ ÙÙ‚Ø· Ù†Ø§Ù… Ø¨Ø¨Ø±ÛŒØ¯ ÛŒØ§ Ø§Ú¯Ø± Ù…Ø§ÛŒÙ„ Ù†ÛŒØ³ØªÛŒØ¯ Ø±Ø¯ Ú©Ù†ÛŒØ¯."
    ],
    validate: v => v && v.trim().length > 2
  },
  {
    key: "dietActivity",
    ask: [
      "Ø§Ù„Ø§Ù† Ø±Ú˜ÛŒÙ… ÛŒØ§ Ø³Ø¨Ú© ØªØºØ°ÛŒÙ‡ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª ÙˆØ±Ø²Ø´ÛŒ Ù‡ÙØªÙ‡â€ŒØ§ÛŒ Ø´Ù…Ø§ Ú†Ù†Ø¯ ØªØ§Ø³ØªØŸ"
    ],
    retry: [
      "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ú©ÙˆØªØ§Ù‡ Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªØºØ°ÛŒÙ‡ Ùˆ ÙØ¹Ø§Ù„ÛŒØª Ù‡ÙØªÚ¯ÛŒ Ø®ÙˆØ¯ØªÙˆÙ† Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ Ø±Ø¯ Ú©Ù†ÛŒØ¯."
    ],
    validate: v => v && v.trim().length > 2
  },
  {
    key: "healthAllergies",
    ask: [
      "Ø¢ÛŒØ§ Ø­Ø³Ø§Ø³ÛŒØª ÛŒØ§ Ø¢Ù„Ø±Ú˜ÛŒ Ø¨Ù‡ Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ ÛŒØ§ Ø¯Ø§Ø±ÙˆÛŒ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯."
    ],
    retry: [
      "Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ø¢Ù„Ø±Ú˜ÛŒ ÛŒØ§ Ø­Ø³Ø§Ø³ÛŒØª ØºØ°Ø§ÛŒÛŒ/Ø¯Ø§Ø±ÙˆÛŒÛŒ Ø±Ùˆ Ø­ØªÛŒ Ø§Ú¯Ø± Ú©Ù…â€ŒØ§Ù‡Ù…ÛŒØª Ø¨Ø§Ø´Ù‡ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ Ø±Ø¯ Ú©Ù†ÛŒØ¯."
    ],
    validate: v => true
  },
  {
    key: "illnessHistory",
    ask: [
      "Ø¢ÛŒØ§ Ø³Ø§Ø¨Ù‚Ù‡ Ø¨ÛŒÙ…Ø§Ø±ÛŒ ÛŒØ§ Ù…ØµØ±Ù Ø¯Ø§Ø±ÙˆÛŒ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø­ØªÛŒ Ú©ÙˆØªØ§Ù‡ Ù…Ø¯Øª Ù‡Ù… Ø§Ú¯Ø± Ø¨ÙˆØ¯Ù‡ Ù…Ù‡Ù…Ù‡ Ø¨Ø¯ÙˆÙ†Ù…."
    ],
    retry: [
      "Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ Ø¨ÛŒÙ…Ø§Ø±ÛŒ ÛŒØ§ Ø¯Ø§Ø±ÙˆÛŒ Ø®Ø§ØµØŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯. Ø§Ú¯Ø± Ù†Ø¯Ø§Ø±ÛŒØ¯ ÙÙ‚Ø· Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ù†Ø¯Ø§Ø±Ù… ÛŒØ§ Ø±Ø¯."
    ],
    validate: v => true
  },
  {
    key: "phone",
    ask: [
      "Ùˆ ÛŒÚ© Ø§Ù…ØªÛŒØ§Ø² ÙˆÛŒÚ˜Ù‡: Ø§Ú¯Ø± Ù…Ø§ÛŒÙ„ Ø¨Ø§Ø´ÛŒØ¯ØŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒØªÙˆÙ† Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ ØªØ®ÙÛŒÙ Ø§Ø®ØªØµØ§ØµÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹ Ø§Ø² Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯! (Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ùˆ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒØ´Ù‡)"
    ],
    retry: [
      "Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…Ú© Ú©Ø¯ ØªØ®ÙÛŒÙ Ùˆ Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒØŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø±Ø¯ Ú©Ù†ÛŒØ¯."
    ],
    validate: v => !v || /^(\+98|0)?9\d{9}$/.test((v||"").trim())
  }
];

const USER = {};
let STEP = 0, repeatCount = 0;
const chatMessages = document.getElementById("chat-messages");
const userInput = document.getElementById("user-input");
const sendButton = document.getElementById("send-button");

function appendMessage(text, sender) {
  const messageDiv = document.createElement("div");
  messageDiv.classList.add("message", sender);
  messageDiv.innerHTML = sender === "bot"
    ? text.replace(/Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±/g, "<strong>Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±</strong>")
    : text;
  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function showLoadingIndicator(text = "") {
  const loadingDiv = document.createElement("div");
  loadingDiv.classList.add("loading-indicator");
  loadingDiv.innerHTML = text
    ? `<span>${text}</span>`
    : `<div class="dot"></div><div class="dot"></div><div class="dot"></div>`;
  chatMessages.appendChild(loadingDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  return loadingDiv;
}
function removeElement(element) {
  if (element && element.parentNode) element.parentNode.removeChild(element);
}
function toggleInput(enabled) {
  userInput.disabled = !enabled;
  sendButton.disabled = !enabled;
  if (enabled) userInput.focus();
}

function personalize(question, prevAnswers) {
  if (typeof question === "function") {
    return question(prevAnswers.name || "", prevAnswers.goal || "");
  }
  return question;
}

function nextQuestion(isRetry = false) {
  if (STEP >= FIELDS.length || (FIELDS[STEP].key === "phone" && Object.keys(USER).length >= FIELDS.length - 1)) {
    appendMessage("Ø¨Ø³ÛŒØ§Ø± Ø¹Ø§Ù„ÛŒ! Ù…Ù…Ù†ÙˆÙ† Ø§Ø² Ø§Ø¹ØªÙ…Ø§Ø¯ Ùˆ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ú¯Ø°Ø§Ø´ØªÛŒØ¯. Ø§Ù„Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ ÛŒÚ© ØªØ­Ù„ÛŒÙ„ ØªØ®ØµØµÛŒ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…Ú©Ù…Ù„ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø§ ØªÙˆØ¶ÛŒØ­ Ú©Ø§Ù…Ù„ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯:", "bot");
    handleRecommendation();
    return;
  }
  let qObj = FIELDS[STEP];
  let prevs = { ...USER };
  let qText = isRetry && qObj.retry ? qObj.retry[0] : personalize(qObj.ask[0], prevs);
  appendMessage(qText, "bot");
  toggleInput(true);
}

async function handleRecommendation() {
  toggleInput(false);
  const loading = showLoadingIndicator("Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¯Ù‚ÛŒÙ‚ ØªÙˆØ³Ø· Ø¯Ú©ØªØ± Ù…Ø´Ø§ÙˆØ± ØªØ®ØµØµÛŒ...");
  const productsText = azarpowderProducts.map(p =>
    `- ${p.name}: ${p.description} | <b>Ù‚ÛŒÙ…Øª:</b> ${p.price} | <b>Ù†Ø­ÙˆÙ‡ Ù…ØµØ±Ù:</b> ${p.howToUse} | <b>Ø¹ÙˆØ§Ø±Ø¶:</b> ${p.sideEffects} | <a href="https://azar-powder.com/product/${p.url}" target="_blank">Ø®Ø±ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ†</a>`
  ).join('\n');

  const prompt = `
Ø´Ù…Ø§ Ù†Ù‚Ø´ ÛŒÚ© Ù¾Ø²Ø´Ú© Ùˆ Ù…Ø´Ø§ÙˆØ± ØªØºØ°ÛŒÙ‡ Ùˆ ÙˆØ±Ø²Ø´ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø¯ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø± Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.
Ø­ØªÛŒ Ø§Ú¯Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ù‚Øµ ÛŒØ§ Ù…Ø¨Ù‡Ù… Ø¨ÙˆØ¯ØŒ Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ùˆ Ø³Ù† Ùˆ Ø¬Ù†Ø³ÛŒØª Ùˆ Ù‡Ø¯Ù Ø§Ø­ØªÙ…Ø§Ù„ÛŒØŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ú©Ù…Ù„â€ŒÙ‡Ø§ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ ØªÙˆØµÛŒÙ‡ Ú©Ù† Ùˆ Ù‡ÛŒÚ†â€ŒÙˆÙ‚Øª Ù†Ú¯ÙˆÛŒÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª ÛŒØ§ Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯.
Ø­ØªÛŒ Ø§Ú¯Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®ÛŒÙ„ÛŒ Ù†Ø§Ù‚Øµ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ±Ø¶ Ø¹Ù…ÙˆÙ…ÛŒ Ø´Ø±Ø§ÛŒØ· Ø¨Ø¯Ù†ÛŒ Ùˆ Ù‡Ø¯ÙØŒ Ø­Ø¯Ø§Ù‚Ù„ Û² Ù…Ú©Ù…Ù„ Ø±Ø§ Ù…ÙØµÙ„ ØªØ­Ù„ÛŒÙ„ Ùˆ Ù…Ø¹Ø±ÙÛŒ Ú©Ù† (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø¹Ø¶Ù„Ù‡â€ŒØ³Ø§Ø²ÛŒØŒ Ù¾Ø±ÙˆØªØ¦ÛŒÙ† ÙˆÛŒ Ùˆ Ú©Ø±Ø§ØªÛŒÙ†).
Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ù‡Ø± Ù…Ú©Ù…Ù„ØŒ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡ Ú†Ø±Ø§ Ø¨Ø§ Ø´Ø±Ø§ÛŒØ· ÙØ¹Ù„ÛŒ ÙØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯ØŒ Ù‚ÛŒÙ…ØªØŒ Ù†Ø­ÙˆÙ‡ Ù…ØµØ±Ù Ùˆ Ù„ÛŒÙ†Ú© Ø®Ø±ÛŒØ¯ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†. 
Ù¾Ø§Ø³Ø® ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯ ÙØ§Ø±Ø³ÛŒØŒ ØªØ­Ù„ÛŒÙ„ÛŒØŒ Ø¨Ø§ Ù„Ø­Ù† Ø¯Ú©ØªØ±Ø§Ù†Ù‡ Ùˆ Ø¯Ø³Øªâ€ŒÚ©Ù… Û²ÛµÛ° Ú©Ù„Ù…Ù‡ Ø¨Ø§Ø´Ø¯. 
Ø­ØªÙ…Ø§Ù‹ Ø¯Ø± Ù¾Ø§ÛŒØ§Ù† Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ Ùˆ ØªÙˆØµÛŒÙ‡ Ø¨Ù‡ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø³Ø§Ù„Ù… Ø¨Ù†ÙˆÛŒØ³.
Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¨ÛŒÙ…Ø§Ø±ÛŒ/Ø¢Ù„Ø±Ú˜ÛŒ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø±Ø§ Ù‡Ù… Ø¨Ù‡â€ŒØµÙˆØ±Øª ÛŒÚ© Ø§Ø·Ù…ÛŒÙ†Ø§Ù† ØªØ®ØµØµÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú©Ù†.
Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:
${Object.entries(USER).map(([k,v])=>`${k}: ${v}`).join('\n')}
Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±:
${productsText}
Ù…ØªÙ† Ù…Ø´Ø§ÙˆØ±Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯. Ø§Ø² Ù‡ÛŒÚ† Ø¨Ù‡Ø§Ù†Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ù†Ø¯Ø§Ø¯Ù† ÛŒØ§ Ù…Ø¹Ø±ÙÛŒ Ù†Ú©Ø±Ø¯Ù† Ù…Ú©Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†!
  `;

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: prompt }] }] })
    });
    removeElement(loading);
    const data = await res.json();
    let answer = (data?.candidates?.[0]?.content?.parts?.[0]?.text ?? "").trim();
    if (!answer || answer.length < 30) {
      answer = `
Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ·ÛŒ Ú©Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯ÛŒØ¯ØŒ Ø¯Ùˆ Ù…Ú©Ù…Ù„ Ú©Ù„ÛŒØ¯ÛŒ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø± Ø±Ø§ Ø¨Ù‡ Ø´Ù…Ø§ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù…:
<br><b>Û±. Ù¾Ø±ÙˆØªØ¦ÛŒÙ† ÙˆÛŒ Ø§ÛŒØ²ÙˆÙ„Ù‡ Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±</b> - Ù…Ù†Ø§Ø³Ø¨ Ø¹Ø¶Ù„Ù‡â€ŒØ³Ø§Ø²ÛŒØŒ Ù…Ø®ØµÙˆØµØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ Ø¨Ø§ ÙˆØ²Ù† Ù¾Ø§ÛŒÛŒÙ† Ùˆ Ø±Ú˜ÛŒÙ… Ú©Ù…â€ŒÚ©Ø§Ù„Ø±ÛŒ. Ù‚ÛŒÙ…Øª: Û³,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†. 
<a href="https://azar-powder.com/product/whey-isolate" target="_blank">Ø®Ø±ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ†</a>
<br><b>Û². Ú©Ø±Ø§ØªÛŒÙ† Ù…ÙˆÙ†ÙˆÙ‡ÛŒØ¯Ø±Ø§Øª Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±</b> - Ø§ÙØ²Ø§ÛŒØ´ Ù‚Ø¯Ø±Øª Ùˆ Ø±ÛŒÚ©Ø§ÙˆØ±ÛŒØŒ ÙˆÛŒÚ˜Ù‡ ØªÙ…Ø±ÛŒÙ†Ø§Øª Ù…Ù‚Ø§ÙˆÙ…ØªÛŒ Ùˆ Ø¨Ø¯Ù†Ø³Ø§Ø²ÛŒ. Ù‚ÛŒÙ…Øª: Û±,Û²Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†. 
<a href="https://azar-powder.com/product/creatine-monohydrate" target="_blank">Ø®Ø±ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ†</a>
<br>Ø¨Ø±Ø§ÛŒ Ø¬Ø²ÛŒÛŒØ§Øª Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± ÛŒØ§ Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÙ…Ø±ÛŒÙ†ÛŒ Ø§Ø®ØªØµØ§ØµÛŒØŒ Ù„Ø·ÙØ§Ù‹ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¨Ø§ Ù…Ù† Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ø´ÛŒØ¯ ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ø² Ø¬Ø´Ù†ÙˆØ§Ø±Ù‡â€ŒÙ‡Ø§ Ù…Ø·Ù„Ø¹ Ø´ÙˆÛŒØ¯. 
<br><b>Ø¨Ø§ Ø¢Ø±Ø²ÙˆÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ùˆ Ø³Ù„Ø§Ù…ØªÛŒ!</b>
`;
    }
    appendMessage(answer, "bot");
    toggleInput(true);
  } catch (e) {
    removeElement(loading);
    appendMessage("Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø³ÛŒØ³ØªÙ… Ù…Ø´Ø§ÙˆØ±Ù‡ ÙØ¹Ù„Ø§ Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.", "bot");
  }
}

async function handleUserInput() {
  const msg = userInput.value.trim();
  if (!msg) return;
  appendMessage(msg, "user");
  userInput.value = "";
  toggleInput(false);

  let field = FIELDS[STEP];
  // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù†ÙˆØ´Øª Ø±Ø¯ ÛŒØ§ Ù‡ÛŒÚ†ØŒ Ø±Ø¯ Ú©Ù†
  if (/^(Ø±Ø¯|Ù‡ÛŒÚ†)$/i.test(msg)) {
    appendMessage("Ú©Ø§Ù…Ù„Ø§Ù‹ Ù‚Ø§Ø¨Ù„ Ø§Ø­ØªØ±Ø§Ù…. Ù…ÛŒâ€ŒØ±ÛŒÙ… Ø³Ø±Ø§Øº Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ø¯ÛŒ.", "bot");
    STEP++; repeatCount = 0;
    setTimeout(() => nextQuestion(false), 800);
    return;
  }
  if (field.validate(msg)) {
    USER[field.key] = msg;
    STEP++; repeatCount = 0;
    setTimeout(() => nextQuestion(false), 800);
  } else {
    repeatCount++;
    if (repeatCount < 3) {
      setTimeout(() => nextQuestion(true), 600);
    } else {
      appendMessage("Ø§Ú¯Ø± ØªÙ…Ø§ÛŒÙ„ÛŒ Ø¨Ù‡ Ù¾Ø§Ø³Ø® Ù†Ø¯Ø§Ø±ÛŒØ¯ØŒ Ú©Ø§ÙÛŒØ³Øª Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ø±Ø¯.", "bot");
      toggleInput(true);
      repeatCount = 0;
    }
  }
}

// Ø´Ø±ÙˆØ¹ Ú¯ÙØªÚ¯Ùˆ
function startConversation() {
  appendMessage(
    "Ø³Ù„Ø§Ù… Ùˆ Ø§Ø±Ø§Ø¯Øª! ğŸ‘¨â€âš•ï¸ Ù…Ù† Ø¯Ú©ØªØ± Ù…Ø´Ø§ÙˆØ± ØªØ®ØµØµÛŒ ØªØºØ°ÛŒÙ‡ Ùˆ ÙˆØ±Ø²Ø´ <strong>Ø¢Ø°Ø±Ù¾ÙˆØ¯Ø±</strong> Ù‡Ø³ØªÙ…. Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒØ´Ù… Ø¨Ø§ Ù‡Ù… ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ… Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ø±Ø§ÛŒØ· Ø´Ù…Ø§ØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ùˆ Ù…Ú©Ù…Ù„ Ù…Ù†Ø§Ø³Ø¨ Ø±Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù…. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø­ÙˆØµÙ„Ù‡ Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ø³Ø§Ø¯Ù‡ Ù…Ù† Ø¬ÙˆØ§Ø¨ Ø¨Ø¯ÛŒØ¯ ØªØ§ Ø¨Ù‡ØªØ±ÛŒÙ† Ù†ØªÛŒØ¬Ù‡ Ø±Ùˆ Ø¨Ú¯ÛŒØ±ÛŒØ¯. Ù‡Ø± Ø²Ù…Ø§Ù† Ø¯ÙˆØ³Øª Ø¯Ø§Ø´ØªÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø³Ø¤Ø§Ù„ Ø¨Ù¾Ø±Ø³ÛŒØ¯ ÛŒØ§ Ø­ØªÛŒ Ø¬ÙˆØ§Ø¨ Ù†Ø¯ÛŒØ¯. Ø¨Ø±ÛŒÙ… Ø³Ø±Ø§Øº Ø§ÙˆÙ„ÛŒÙ† Ø³Ø¤Ø§Ù„:",
    "bot"
  );
  setTimeout(() => nextQuestion(false), 1300);
  toggleInput(true);
}

sendButton.addEventListener("click", handleUserInput);
userInput.addEventListener("keypress", e => {
  if (e.key === "Enter" && !userInput.disabled) handleUserInput();
});
window.onload = startConversation;
</script>
</body>
</html>
