<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@700&display=swap"
      rel="stylesheet"
    />
    <title>Task Board</title>
    <style>
      body {
        font-family: "Vazirmatn", sans-serif;
        margin: 0;
        padding: 0;
      }

      .task-board {
        display: flex;
        justify-content: space-between;
        padding: 20px;
      }

      .column {
        flex-grow: 1;
        background-color: #f2f2f2;
        border-radius: 5px;
        padding: 10px;
        margin: 0 10px;
      }

      .column-header {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .task-list {
        min-height: 100px;
        background-color: #ffffff;
        border: 1px solid #cccccc;
        border-radius: 5px;
        padding: 10px;
      }

      .task {
        background-color: #ffffff;
        border: 1px solid #cccccc;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
        cursor: move;
      }

      .task-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .task-title {
        margin-right: 10px;
      }

      .task-actions {
        display: flex;
        align-items: center;
      }

      .task-action {
        margin-left: 5px;
        cursor: pointer;
      }
      #add {
        padding: 10px;
        margin-left: 30px;
        width: 100px;
        margin-top: 15px;
        background-color: cadetblue;
        color: aliceblue;
        display: flex;
      }
    </style>
  </head>
  <body>
    <div><button id="add" onclick="handleAddTask()">Add Task</button></div>
    <div class="task-board">
      <div class="column">
        <div class="column-header" id="todoColumnName">To Do</div>
        <div
          class="task-list"
          id="todoColumn"
          ondrop="handleDrop(event, 'todoColumn');"
          ondragover="handleDragOver(event);"
        ></div>
      </div>
      <div class="column">
        <div class="column-header" id="inProgressColumnName">In Progress</div>
        <div
          class="task-list"
          id="inProgressColumn"
          ondrop="handleDrop(event, 'inProgressColumn');"
          ondragover="handleDragOver(event);"
        ></div>
      </div>
      <div class="column">
        <div class="column-header" id="doneColumnName">Done</div>
        <div
          class="task-list"
          id="doneColumn"
          ondrop="handleDrop(event, 'doneColumn');"
          ondragover="handleDragOver(event);"
        ></div>
      </div>
    </div>

    <script>
      let tasks = [];

      // Check if tasks are already stored in localStorage
      if (localStorage.getItem("tasks")) {
        tasks = JSON.parse(localStorage.getItem("tasks"));
        renderTasks();
      }

      function saveTasks() {
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      function createTaskElement(taskId, taskTitle) {
        const taskElement = document.createElement("div");
        taskElement.className = "task";
        taskElement.id = taskId;
        taskElement.setAttribute("draggable", "true");
        taskElement.setAttribute("data-task-id", taskId);
        taskElement.addEventListener("dragstart", handleDragStart);

        taskElement.innerHTML = `
        <div class="task-box">
          <div class="task-title">${taskTitle}</div>
          <div class="task-actions">
            <span class="task-action" onclick="handleEditTask(event)">&#9998;</span>
            <span class="task-action" onclick="handleDeleteTask(event)">&#128465;</span>
          </div>
        </div>
      `;

        return taskElement;
      }

      function renderTasks() {
        const todoColumn = document.getElementById("todoColumn");
        const inProgressColumn = document.getElementById("inProgressColumn");
        const doneColumn = document.getElementById("doneColumn");

        // Clear existing tasks
        todoColumn.innerHTML = "";
        inProgressColumn.innerHTML = "";
        doneColumn.innerHTML = "";

        // Render tasks in respective columns
        tasks.forEach((task) => {
          const { id, title, column } = task;
          const taskElement = createTaskElement(id, title);

          switch (column) {
            case "todoColumn":
              todoColumn.appendChild(taskElement);
              break;
            case "inProgressColumn":
              inProgressColumn.appendChild(taskElement);
              break;
            case "doneColumn":
              doneColumn.appendChild(taskElement);
              break;
            default:
              todoColumn.appendChild(taskElement);
              break;
          }
        });
      }

      function handleAddTask() {
        const taskTitle = prompt("Enter task title:");
        if (taskTitle) {
          const taskId = `task${Date.now()}`;
          const taskElement = createTaskElement(taskId, taskTitle);
          tasks.push({ id: taskId, title: taskTitle, column: "todoColumn" });
          saveTasks();
          renderTasks();
        }
      }

      let currentTaskId;

      function handleDragStart(event) {
        const taskId = event.target.getAttribute("data-task-id");
        currentTaskId = taskId;
      }

      function handleDrop(event, columnName) {
        event.preventDefault();
        const column = document.getElementById(columnName);
        const taskElement = document.getElementById(currentTaskId);
        column.appendChild(taskElement);

        // Update task's column in the tasks array
        const task = tasks.find((t) => t.id === currentTaskId);
        task.column = columnName;
        saveTasks();
      }

      function handleDragOver(event) {
        event.preventDefault();
      }

      function handleEditTask(event) {
        const taskElement = event.target.closest(".task");
        const taskId = taskElement.getAttribute("data-task-id");
        const task = tasks.find((t) => t.id === taskId);
        const newTaskTitle = prompt("Enter new task title:", task.title);
        if (newTaskTitle) {
          task.title = newTaskTitle;
          const taskTitleElement = taskElement.querySelector(".task-title");
          taskTitleElement.textContent = newTaskTitle;
          saveTasks();
        }
      }

      function handleDeleteTask(event) {
        const taskElement = event.target.closest(".task");
        const taskId = taskElement.getAttribute("data-task-id");
        tasks = tasks.filter((t) => t.id !== taskId);
        taskElement.remove();
        saveTasks();
      }
    </script>
  </body>
</html>
