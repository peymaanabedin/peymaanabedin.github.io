
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>کارت دعوت عقد با مهر تپنده و انیمیشن اسپارکل</title>
  <link href="https://cdn.fontcdn.ir/Font/Persian/IranNastaliq/IranNastaliq.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Shabnam/Shabnam.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/IRANYekanWeb/IRANYekanWeb.css" rel="stylesheet">
  <style>
    html,body {
      margin: 0; padding: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 50% 30%, #fbeeee 60%, #f5e9e7 100%);
      font-family: 'Shabnam', 'IRANYekanWeb', sans-serif;
      overflow-x: hidden;
      display: flex; align-items: center; justify-content: center;
      direction: rtl;
    }
    /* ------------------- مهر موم با تپش قلب ------------------- */
    .center-layer {
      position: fixed; inset: 0; z-index: 999;
      background: rgba(248,237,227,0.94); /* -- رنگ پس زمینه درخواست شده -- */
      display: flex; align-items: center; justify-content: center;
      transition: background 0.5s cubic-bezier(.39,1.14,.75,1.04);
    }
    .fancy-seal-btn {
      outline: none; border: none; background: none; cursor: pointer;
      display: flex; flex-direction: column; align-items: center; position: relative;
    }
    .fancy-seal-svg {
      width: 170px; height: 170px;
      transition: filter .4s, box-shadow .3s, transform .3s cubic-bezier(.44,1.6,.52,1);
      filter: drop-shadow(0 4px 28px #e6b9c855) drop-shadow(0 2px 9px #ce8da866);
      will-change: filter, transform;
      background: none; z-index: 2;
      /* افکت تپش */
      animation: seal-beat 2.1s cubic-bezier(.42,0,.62,1.08) infinite;
    }
    @keyframes seal-beat {
      0% {transform: scale(1);}
      13% {transform: scale(1.033) rotate(-2deg);}
      17% {transform: scale(1.08) rotate(-3deg);}
      20% {transform: scale(1.042) rotate(2deg);}
      24% {transform: scale(1.06);}
      26% {transform: scale(1.017);}
      32% {transform: scale(1);}
      100% {transform: scale(1);}
    }
    .fancy-seal-btn:hover .fancy-seal-svg,
    .fancy-seal-btn:focus .fancy-seal-svg {
      filter: drop-shadow(0 6px 48px #e6b9c8bb) drop-shadow(0 6px 19px #ce8da8b7) brightness(1.14);
      transform: scale(1.06) rotate(-4deg);
      animation-play-state: paused !important;
    }
    /* متن راهنما */
    .seal-hint {
      font-size: .87rem;
      color: #b37a8e;
      margin-top: 19px;
      opacity: .8;
      text-align: center;
      letter-spacing: .05em;
      text-shadow: 0 2px 8px #fff7, 0 0 1px #cf9ab3;
      font-weight: 500;
      position: relative;
      z-index: 3;
    }
    /* اسپارکل اطراف مهر */
    .seal-sparkle {
      position: absolute; pointer-events: none; z-index: 5;
      width: 16px; height: 16px; opacity: .72;
      filter: blur(0.4px) brightness(1.08);
      animation: sparkle-move 3.2s infinite cubic-bezier(.3,1.2,.51,1.1);
    }
    @keyframes sparkle-move {
      0% {opacity:.42; transform: scale(1) rotate(0deg);}
      37% {opacity:.97; transform: scale(1.35) rotate(27deg);}
      70% {opacity:.88;}
      100% {opacity:.42; transform: scale(1) rotate(0deg);}
    }
    .sparkle1 {top:16px; left:41px;}
    .sparkle2 {top:18px; right:44px;}
    .sparkle3 {bottom:36px; right:23px;}
    .sparkle4 {bottom:22px; left:36px;}
    .sparkle5 {top:56px; left:10px;}
    .sparkle6 {bottom:66px; right:5px;}
    /* ------------------- کارت دعوت لوکس ------------------- */
    .wedding-card-container {
      position: fixed; inset: 0; z-index: 2;
      display: flex; align-items: center; justify-content: center;
      pointer-events: none; opacity: 0;
      transition: opacity .7s;
    }
    .wedding-card-container.show {opacity: 1; pointer-events: auto; transition: opacity 1.1s;}
    .wedding-card {
      width: 98vw; max-width: 600px; aspect-ratio: 4/3;
      position: relative; overflow: visible;
      transform: translateY(70px) scale(.97) rotateX(14deg);
      opacity: 0; filter: blur(10px) brightness(1.04);
      animation: none; z-index: 3;
      background: linear-gradient(135deg, #fdf6ea 70%, #efe9db 100%);
      border-radius: 32px;
      box-shadow: 0 8px 32px rgba(120,90,30,0.13), 0 2px 12px 1px #fff5e1 inset;
      border: 3px dotted #d9c085; outline: 3px solid #cfb87c; outline-offset: 10px;
      background-blend-mode: multiply;
      background-image: url('data:image/svg+xml;utf8,<svg width="600" height="450" xmlns="http://www.w3.org/2000/svg"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" seed="1" /></filter><rect width="100%" height="100%" fill="none" filter="url(%23noise)" opacity="0.13" /></svg>');
    }
    .wedding-card-container.show .wedding-card {
      animation: cardReveal 1.5s cubic-bezier(.3,1.2,.42,1) both;
    }
    @keyframes cardReveal {
      0% {transform: translateY(60px) scale(.98) rotateX(18deg); filter: blur(10px) brightness(1.04); opacity: 0;}
      20% {filter: blur(6px);}
      50% {transform: translateY(-12px) scale(1.04) rotateX(-6deg); filter: blur(1.5px) brightness(1.08);}
      80% {filter: blur(0.5px);}
      100% {transform: translateY(0) scale(1) rotateX(0deg); opacity: 1; filter: blur(0);}
    }
    .border-decor {position: absolute; pointer-events: none; inset: 0; z-index: 2; border-radius: 32px;}
    .golden-frame {position: absolute; inset: 10px; border: 3px dotted #d3af60; border-radius: 24px; pointer-events: none; z-index: 3; box-shadow: 0 0 0 3px #fff0, 0 2px 4px 1px #dfc7926b inset;}
    .flower-svg {position: absolute; z-index: 4; width: 60px; opacity: .96; filter: drop-shadow(0 3px 7px #fff8);}
    .flower-svg.flower1 { bottom: 30px; right: 28px; }
    .flower-svg.flower2 { bottom: 22px; left: 24px; }
    .flower-svg.flower3 { top: 32px; left: 38px; width: 50px;}
    .flower-svg.flower4 { top: 28px; right: 35px; width: 44px;}
    .bird-svg {position: absolute; top: 20px; width: 48px; opacity: .93; z-index: 6;}
    .bird-svg.left { left: 100px; transform: scaleX(-1) rotate(-10deg);}
    .bird-svg.right { right: 100px; transform: rotate(10deg);}
    .seal {position: absolute; bottom: 20px; right: 18px; width: 56px; z-index: 15; opacity: .93;}
    .card-content {position: absolute; inset: 0 0 0 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 8; padding: 48px 32px 64px 32px; text-align: center; user-select: text;}
    .main-title {font-family: 'IranNastaliq', serif; font-size: 2.6rem; color: #bb8843; margin-bottom: 14px; text-shadow: 0 3px 12px #fff4, 0 0px 2px #b99553cc; letter-spacing: .02em; filter: drop-shadow(0 0 10px #e6c67a5c);}
    .names {font-family: 'IRANYekanWeb', sans-serif; font-size: 1.4rem; color: #593d2b; font-weight: 700; margin-bottom: 18px; letter-spacing: .06em; background: rgba(245,235,210,0.7); border-radius: 10px; display: inline-block; padding: 3px 22px; box-shadow: 0 2px 8px #fff2 inset;}
    .invite-text {font-family: 'Shabnam', sans-serif; font-size: 1.05rem; color: #49341b; background: rgba(250,245,230,0.83); border-radius: 10px; padding: 10px 14px 14px 14px; box-shadow: 0 2px 8px #fff4 inset; line-height: 2.2; margin-bottom: 8px; margin-top: 6px;}
    /* نقاط نورانی کارت (اسپارکل آرام‌تر: زمان چرخه ۶ثانیه) */
    .glow-dot {position: absolute; border-radius: 50%; width: 12px; height: 12px; background: radial-gradient(circle, #fffbe6 60%, #ffd58d88 90%, #fff0 100%); box-shadow: 0 0 18px 5px #ffdba9cc, 0 0 8px 0px #fff5; opacity: .87; pointer-events: none; z-index: 10; animation: sparkle-dot 6s infinite alternate;}
    @keyframes sparkle-dot {
      0% { filter: blur(0.5px) brightness(1.3);}
      40% {filter: blur(1.2px) brightness(1.7);}
      100% {filter: blur(0.3px) brightness(1.1);}
    }
    @media (max-width: 600px) {
      .fancy-seal-svg {width: 108px; height: 108px;}
      .seal-hint {font-size: .76rem; margin-top:9px;}
      .wedding-card-container {max-width: 98vw; aspect-ratio: 4/5;}
      .wedding-card { border-radius: 18px; }
      .border-decor { border-radius: 18px; }
      .golden-frame { border-radius: 12px; }
      .flower-svg { width: 33px !important;}
      .bird-svg { width: 33px;}
      .seal { width: 30px;}
      .main-title {font-size: 1.44rem;}
      .names {font-size: .95rem; padding:2px 8px;}
      .invite-text {font-size:.87rem;}
    }
  </style>
</head>
<body>
  <audio autoplay loop id="bg-music" src="https://cdn.pixabay.com/audio/2022/10/05/audio_ac81e8a26f.mp3">
      مرورگر شما از پخش صدا پشتیبانی نمی‌کند.
  </audio>
  <div class="center-layer" id="sealLayer">
    <svg class="seal-sparkle sparkle1" viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="5" fill="#fff6fa"/><circle cx="12" cy="12" r="2" fill="#ffdbe6"/><ellipse cx="12" cy="6" rx="1.1" ry=".45" fill="#fff3"/></g></svg>
    <svg class="seal-sparkle sparkle2" viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="4" fill="#fffdfb"/><circle cx="12" cy="12" r="1.7" fill="#f3c0dc"/><ellipse cx="19" cy="7" rx="1" ry=".44" fill="#fff4"/></g></svg>
    <svg class="seal-sparkle sparkle3" viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="3.1" fill="#fff9f6"/><ellipse cx="18" cy="8" rx="1.1" ry=".55" fill="#fff9"/></g></svg>
    <svg class="seal-sparkle sparkle4" viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="2.4" fill="#fff"/><ellipse cx="6" cy="18" rx="1.1" ry=".4" fill="#fff3"/></g></svg>
    <svg class="seal-sparkle sparkle5" viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="1.6" fill="#fff"/><ellipse cx="8" cy="12" rx=".4" ry=".19" fill="#ffe3f6"/></g></svg>
    <svg class="seal-sparkle sparkle6" viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="1.7" fill="#fff7f7"/><ellipse cx="16" cy="8" rx="1" ry=".35" fill="#ffe2f1"/></g></svg>
    <button class="fancy-seal-btn" tabindex="0" id="sealBtn" aria-label="باز کردن کارت دعوت">
      <svg class="fancy-seal-svg" viewBox="0 0 220 220" fill="none">
        <path d="M34 99 Q12 84 41 56 Q56 41 97 34 Q116 20 160 41 Q187 48 189 73 Q212 98 196 122 Q200 170 157 185 Q134 207 103 191 Q74 206 55 190 Q16 176 31 143 Q16 126 34 99Z"
          fill="url(#sealGrad)" filter="url(#shadow)" />
        <ellipse cx="110" cy="110" rx="77" ry="74" fill="url(#sealInner)" opacity="0.85"/>
        <ellipse cx="110" cy="110" rx="65" ry="62.5" fill="none" stroke="#d7aab5" stroke-width="3.3"/>
        <ellipse cx="110" cy="110" rx="56" ry="53" fill="none" stroke="#edc1d2" stroke-width="1.7" opacity="0.7"/>

        <g transform="translate(110, 110) rotate(225) translate(-30, -30)">
            <path
                d="M0 60 v-60 h60 a30,30 90 0,1 0,60 a30,30 90 0,1 -60,0 z"
                fill="#fff" stroke="#d1778d" stroke-width="2.2" filter="url(#hglow)"
            />
            <path
                d="M0 60 v-60 h60 a30,30 90 0,1 0,60 a30,30 90 0,1 -60,0 z"
                fill="none" stroke="#fff2f7" stroke-width="1.2"
            />
        </g>
        <defs>
          <radialGradient id="sealGrad" cx="50%" cy="50%" r="65%">
            <stop offset="0%" stop-color="#fde0ed"/>
            <stop offset="52%" stop-color="#d9a8b9"/>
            <stop offset="80%" stop-color="#ad7189"/>
            <stop offset="100%" stop-color="#ba98a7"/>
          </radialGradient>
          <radialGradient id="sealInner" cx="50%" cy="52%" r="70%">
            <stop offset="0%" stop-color="#fff2f6"/>
            <stop offset="60%" stop-color="#eec3db"/>
            <stop offset="95%" stop-color="#d7aab5"/>
          </radialGradient>
          <filter id="shadow"><feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="#b46b7d" flood-opacity="0.24"/></filter>
          <filter id="hglow" x="-20%" y="-20%" width="140%" height="140%">
            <feGaussianBlur stdDeviation="3" result="blur"/>
            <feMerge>
              <feMergeNode in="blur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
      </svg>
      <div class="seal-hint">برای باز شدن کارت، کلیک کنید</div>
    </button>
  </div>
  <div class="wedding-card-container" id="cardLayer">
    <div class="wedding-card" id="weddingCard">
      <svg class="border-decor" width="100%" height="100%" viewBox="0 0 600 450" fill="none">
        <defs>
          <radialGradient id="g1" cx="50%" cy="50%" r="60%">
            <stop offset="0%" stop-color="#f9eebd" />
            <stop offset="60%" stop-color="#edd6ab" />
            <stop offset="100%" stop-color="#fff0" />
          </radialGradient>
        </defs>
        <path d="M10,20 Q40,0 90,30" stroke="#e7cf97" stroke-width="2.3" fill="none"/><path d="M590,20 Q560,0 510,30" stroke="#e7cf97" stroke-width="2.3" fill="none"/><path d="M10,430 Q40,450 90,420" stroke="#e7cf97" stroke-width="2.3" fill="none"/><path d="M590,430 Q560,450 510,420" stroke="#e7cf97" stroke-width="2.3" fill="none"/><circle cx="35" cy="30" r="12" fill="url(#g1)" stroke="#e6d3a3" stroke-width="1.7"/><circle cx="565" cy="30" r="12" fill="url(#g1)" stroke="#e6d3a3" stroke-width="1.7"/><circle cx="35" cy="420" r="12" fill="url(#g1)" stroke="#e6d3a3" stroke-width="1.7"/><circle cx="565" cy="420" r="12" fill="url(#g1)" stroke="#e6d3a3" stroke-width="1.7"/>
      </svg>
      <div class="golden-frame"></div>
      <svg class="flower-svg flower1" viewBox="0 0 50 50"><ellipse cx="24" cy="28" rx="12" ry="6" fill="#fff" stroke="#d6c1aa" stroke-width="1.2"/><ellipse cx="26" cy="22" rx="8" ry="8" fill="#fff" stroke="#d6c1aa" stroke-width="1.2"/><ellipse cx="32" cy="18" rx="2.2" ry="4.2" fill="#fff" stroke="#d6c1aa" stroke-width="1.2"/><ellipse cx="18" cy="18" rx="2.2" ry="4.2" fill="#fff" stroke="#d6c1aa" stroke-width="1.2"/><circle cx="24" cy="24" r="3.6" fill="#eed3a6" stroke="#e1b475" stroke-width="1"/></svg>
      <svg class="flower-svg flower2" viewBox="0 0 44 44"><ellipse cx="20" cy="20" rx="10" ry="5" fill="#fff" stroke="#d6c1aa" stroke-width="1.1"/><ellipse cx="22" cy="14" rx="7" ry="7" fill="#fff" stroke="#d6c1aa" stroke-width="1.1"/><ellipse cx="28" cy="10" rx="2" ry="3.3" fill="#fff" stroke="#d6c1aa" stroke-width="1.1"/><ellipse cx="14" cy="10" rx="2" ry="3.3" fill="#fff" stroke="#d6c1aa" stroke-width="1.1"/><circle cx="20" cy="16" r="3" fill="#eed3a6" stroke="#e1b475" stroke-width=".8"/></svg>
      <svg class="flower-svg flower3" viewBox="0 0 44 44"><ellipse cx="20" cy="20" rx="10" ry="5" fill="#fff" stroke="#d6c1aa" stroke-width="1.1"/><circle cx="20" cy="16" r="3" fill="#eed3a6" stroke="#e1b475" stroke-width=".8"/></svg>
      <svg class="flower-svg flower4" viewBox="0 0 36 36"><ellipse cx="16" cy="18" rx="6" ry="3" fill="#fff" stroke="#d6c1aa" stroke-width="1"/><circle cx="16" cy="14" r="2" fill="#eed3a6" stroke="#e1b475" stroke-width=".8"/></svg>
      <svg class="bird-svg left" viewBox="0 0 44 26"><path d="M6 16Q14 4 34 8Q28 16 44 20Q34 19 28 24Q22 18 6 16Z" fill="#fff" stroke="#d8d2bb" stroke-width="1.1"/><ellipse cx="9" cy="17" rx="1.5" ry="1" fill="#b6a692" /></svg>
      <svg class="bird-svg right" viewBox="0 0 44 26"><path d="M6 16Q14 4 34 8Q28 16 44 20Q34 19 28 24Q22 18 6 16Z" fill="#fff" stroke="#d8d2bb" stroke-width="1.1"/><ellipse cx="9" cy="17" rx="1.5" ry="1" fill="#b6a692" /></svg>
      <svg class="seal" viewBox="0 0 60 60"><circle cx="30" cy="30" r="25" fill="#fff6dc" stroke="#e1c070" stroke-width="2.3"/><circle cx="30" cy="30" r="20" fill="none" stroke="#e2c488" stroke-width="1.2" stroke-dasharray="2,3"/><text x="50%" y="44%" text-anchor="middle" font-family="Shabnam" font-size="11" fill="#bca054" font-weight="bold" alignment-baseline="middle">با مهر</text><text x="50%" y="58%" text-anchor="middle" font-family="Shabnam" font-size="8" fill="#bca054">و احترام</text><ellipse cx="30" cy="48" rx="8" ry="4" fill="none" stroke="#e5d1a7" stroke-width="1"/><circle cx="30" cy="48" r="2" fill="#e5d1a7"/></svg>
      <div class="card-content">
        <div class="main-title">دعوت به مراسم عقد</div>
        <div class="names">سمیرا و پیمان</div>
        <div class="invite-text">
          با شادی بی‌پایان شما را به مراسم عقد خود دعوت می‌کنیم<br>
          تاریخ: شهریور ۱۴۰۴  &nbsp; | &nbsp;  ساعت: ۱۴:۰۰<br>
          محل برگزاری: باغ سردرود<br>
        </div>
      </div>
      <div class="glow-dot" style="top:58px; left:45%; width:11px;height:11px;"></div><div class="glow-dot" style="top:92px; right:38%; width:9px;height:9px;"></div><div class="glow-dot" style="top:145px; left:28%;"></div><div class="glow-dot" style="top:120px; right:27%;"></div><div class="glow-dot" style="top:130px; left:62%; width:10px;height:10px;"></div><div class="glow-dot" style="top:92px; right:17%;"></div><div class="glow-dot" style="top:145px; right:16%; width:8px;height:8px;"></div><div class="glow-dot" style="top:175px; left:52%; width:7px;height:7px;"></div>
      <canvas id="confettiCanvas" style="position:absolute;inset:0;z-index:25;pointer-events:none;"></canvas>
    </div>
  </div>
  <script>
    // نمایش کارت پس از کلیک مهر
    const sealBtn = document.getElementById('sealBtn');
    const sealLayer = document.getElementById('sealLayer');
    const cardLayer = document.getElementById('cardLayer');
    let cardShown = false;
    function openCard() {
      if (cardShown) return;
      cardShown = true;
      // شروع پخش موسیقی در اولین تعامل کاربر
      const music = document.getElementById('bg-music');
      if (music.paused) {
          music.play().catch(e => console.log("Autoplay was prevented.", e));
      }
      sealBtn.classList.add('seal-hide');
      setTimeout(() => { sealLayer.style.background = 'rgba(248,237,227,0)'; }, 600);
      setTimeout(() => {
        sealLayer.style.display = 'none';
        cardLayer.classList.add('show');
        // افکت اسپارکل و کنفتی بعد از نمایش کارت
        setTimeout(() => { if (window.confettiEffect) confettiEffect(); }, 900);
      }, 1120);
    }
    sealBtn.addEventListener('click', openCard);
    sealBtn.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') openCard(); });
    sealBtn.addEventListener('touchstart', openCard, {passive: true});
    // کانواس واکنش‌گرا برای کنفتی
    function fitCanvas() {
      const card = document.getElementById('weddingCard');
      const canvas = document.getElementById('confettiCanvas');
      if (!card || !canvas) return;
      canvas.width = card.offsetWidth * window.devicePixelRatio;
      canvas.height = card.offsetHeight * window.devicePixelRatio;
      canvas.style.width = card.offsetWidth + 'px';
      canvas.style.height = card.offsetHeight + 'px';
    }
    window.addEventListener('resize', fitCanvas);
    setTimeout(fitCanvas, 300);
    // افکت کنفتی و جرقه
    let confettiActive = false;
    function confettiEffect() {
      if (confettiActive) return;
      confettiActive = true;
      fitCanvas();
      const canvas = document.getElementById('confettiCanvas');
      const ctx = canvas.getContext('2d');
      const W = canvas.width, H = canvas.height;
      const confettiColors = ['#e7c67b', '#f6ead2', '#e2d3bb', '#fff', '#bb8843', '#f5ede2', '#dfc48c', '#fff8eb', '#a46b30', '#d8b98b'];
      const sparkColors = ['rgba(255,235,180,.88)','rgba(255,255,200,.76)','rgba(230,206,130,.74)','rgba(250,236,192,.81)'];
      function drawConfetti(x, y, r, color, shape, rotate) {
        ctx.save(); ctx.globalAlpha = 0.85; ctx.beginPath();
        if (shape === 'circle') {
          ctx.arc(x, y, r, 0, 2 * Math.PI); ctx.fillStyle = color;
          ctx.shadowColor = '#fff8'; ctx.shadowBlur = 5 * r; ctx.fill();
        } else if (shape === 'star') {
          ctx.translate(x, y); ctx.rotate(rotate); ctx.moveTo(0, -r);
          for (let i = 0; i < 5; i++) {
            ctx.rotate(Math.PI / 5); ctx.lineTo(0, -r * 0.45);
            ctx.rotate(Math.PI / 5); ctx.lineTo(0, -r);
          }
          ctx.fillStyle = color; ctx.shadowColor = '#fff8'; ctx.shadowBlur = 7 * r; ctx.fill();
        }
        ctx.restore();
      }
      function drawSparkle(x, y, r, color, glow) {
        ctx.save(); ctx.globalAlpha = glow; ctx.beginPath();
        ctx.arc(x, y, r, 0, 2 * Math.PI);
        ctx.fillStyle = color; ctx.shadowColor = '#fffda7'; ctx.shadowBlur = 12 * r; ctx.fill(); ctx.restore();
      }
      let confetti = [], sparkles = [];
      for (let i = 0; i < 32; i++) {
        confetti.push({x: Math.random() * W, y: H + Math.random() * H * 0.35, r: 6 + Math.random() * 9, color: confettiColors[Math.floor(Math.random() * confettiColors.length)], shape: Math.random() > 0.55 ? 'star' : 'circle', vx: -1.8 + Math.random() * 3.6, vy: -3.4 - Math.random() * 2, rotate: Math.random() * Math.PI * 2, vr: -0.03 + Math.random() * 0.06, a: 0.85 + Math.random() * .25 });
      }
      for (let i = 0; i < 18; i++) {
        sparkles.push({x: Math.random() * W, y: H + Math.random() * H * 0.35, r: 3 + Math.random() * 6, color: sparkColors[Math.floor(Math.random() * sparkColors.length)], vx: -1 + Math.random() * 2, vy: -3.2 - Math.random() * 1.7, alpha: 0.7 + Math.random() * 0.7, pulse: 0.4 + Math.random() * .5, life: 60 + Math.random() * 32, maxLife: 60 + Math.random() * 32 });
      }
      let t = 0, duration = 2300;
      function animate() {
        ctx.clearRect(0, 0, W, H);
        confetti.forEach(p => {
          drawConfetti(p.x, p.y, p.r, p.color, p.shape, p.rotate);
          p.x += p.vx * (1 + .13 * Math.sin(t / 120)); p.y += p.vy * (0.84 + .17 * Math.cos(t / 100));
          p.vy += 0.06; p.rotate += p.vr; p.a *= 0.99;
        });
        sparkles.forEach(s => {
          drawSparkle(s.x, s.y, s.r * (0.7 + .6 * Math.sin(t / 20)), s.color, s.alpha);
          s.x += s.vx; s.y += s.vy; s.vy += 0.06; s.alpha *= 0.97; s.life--;
        });
        confetti = confetti.filter(p => p.y < H + 20 && p.a > 0.13);
        sparkles = sparkles.filter(s => s.life > 0 && s.alpha > .08);
        t += 1;
        if ((confetti.length || sparkles.length) && t * 17 < duration * 1.5) {
          requestAnimationFrame(animate);
        } else {ctx.clearRect(0, 0, W, H); confettiActive = false;}
      }
      animate();
    }
  </script>
</body>
</html>
